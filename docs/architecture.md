# ğŸ—ï¸ Redis Cluster æ¶æ„è¯´æ˜

## ğŸ”— é›†ç¾¤æ¶æ„

Redis Clusterè‡ªåŠ¨å°†æ•°æ®åˆ†ç‰‡åˆ°16384ä¸ªæ§½ä½ï¼Œåœ¨6ä¸ªèŠ‚ç‚¹é—´åˆ†å¸ƒï¼š

- **3ä¸ªä¸»èŠ‚ç‚¹** (7000, 7001, 7002) - è´Ÿè´£æ•°æ®å†™å…¥å’Œåˆ†ç‰‡
- **3ä¸ªä»èŠ‚ç‚¹** (7003, 7004, 7005) - æä¾›é«˜å¯ç”¨å’Œè¯»å–åˆ†æµ

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

- ğŸ“Š **æ•°æ®åˆ†ç‰‡** - 16384ä¸ªæ§½ä½è‡ªåŠ¨åˆ†é…
- ğŸ›¡ï¸ **æ•…éšœè½¬ç§»** - ä¸»èŠ‚ç‚¹å®•æœºæ—¶ä»èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡  
- âš–ï¸ **è´Ÿè½½å‡è¡¡** - è¯»å†™è¯·æ±‚æ™ºèƒ½è·¯ç”±
- ğŸ“ˆ **åœ¨çº¿æ‰©å®¹** - æ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤èŠ‚ç‚¹
- ğŸ”’ **å¼ºä¸€è‡´æ€§** - åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¿è¯

## ğŸ”§ æŠ€æœ¯æ ˆ

### ğŸ³ Redisé•œåƒé€‰æ‹©
- **é•œåƒ**: redis:7.4 (å®˜æ–¹é•œåƒ)
- **ä¼˜åŠ¿**: ç¨³å®šå¯é ï¼Œç¤¾åŒºæ”¯æŒå¥½ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–
- **é…ç½®**: å¯ç”¨é›†ç¾¤æ¨¡å¼ï¼Œç‹¬ç«‹èŠ‚ç‚¹å¯åŠ¨

### ğŸš€ é›†ç¾¤åˆ›å»ºç­–ç•¥
- **æ–¹å¼**: ç‹¬ç«‹èŠ‚ç‚¹ + è‡ªåŠ¨é›†ç¾¤åˆ›å»º
- **æµç¨‹**: å…ˆå¯åŠ¨ç‹¬ç«‹èŠ‚ç‚¹ï¼Œå†è‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºé›†ç¾¤
- **å¥½å¤„**: é¿å…ç¬¬ä¸‰æ–¹é•œåƒçš„å…¼å®¹æ€§é—®é¢˜

### ğŸŒ ç½‘ç»œé…ç½®
- **ç½‘ç»œ**: redis-cluster-network (172.20.0.0/16)
- **æœåŠ¡å‘ç°**: å®¹å™¨é—´DNSè‡ªåŠ¨è§£æ
- **ç«¯å£æ˜ å°„**: 7000-7005 + é›†ç¾¤æ€»çº¿17000-17005

## ğŸ¯ ç»„ä»¶è¯´æ˜

### Redis ClusterèŠ‚ç‚¹
6ä¸ªRediså®ä¾‹ç‹¬ç«‹å¯åŠ¨ï¼Œé…ç½®é›†ç¾¤æ¨¡å¼ï¼š
```yaml
command: >
  redis-server 
  --cluster-enabled yes
  --cluster-config-file nodes.conf
  --cluster-node-timeout 5000
  --appendonly yes
  --requirepass redis123456
  --masterauth redis123456
  --protected-mode no
```

### è‡ªåŠ¨é›†ç¾¤åˆ›å»º
å¯åŠ¨è„šæœ¬è‡ªåŠ¨æ£€æµ‹å¹¶åˆ›å»ºé›†ç¾¤ï¼š
```bash
# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
cluster_state=$(docker exec redis-node-0 redis-cli -a redis123456 -c cluster info 2>/dev/null | grep "cluster_state:ok" || echo "")

# å¦‚æœæ²¡æœ‰é›†ç¾¤ï¼Œè‡ªåŠ¨åˆ›å»º
if [ -z "$cluster_state" ]; then
    docker exec redis-node-0 redis-cli -a redis123456 --cluster create \
        redis-node-0:6379 redis-node-1:6379 redis-node-2:6379 \
        redis-node-3:6379 redis-node-4:6379 redis-node-5:6379 \
        --cluster-replicas 1 --cluster-yes
fi
```

### Redis Insight
å®˜æ–¹Webç®¡ç†ç•Œé¢ï¼Œæä¾›é›†ç¾¤ç›‘æ§å’Œç®¡ç†åŠŸèƒ½

### Redis Exporter  
PrometheusæŒ‡æ ‡å¯¼å‡ºå™¨ï¼Œç”¨äºç›‘æ§é›†ç¾¤çŠ¶æ€å’Œæ€§èƒ½

## ğŸ” æ•°æ®æµ

1. **å†™å…¥è¯·æ±‚** â†’ è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”æ§½ä½çš„ä¸»èŠ‚ç‚¹
2. **è¯»å–è¯·æ±‚** â†’ å¯ä»ä¸»èŠ‚ç‚¹æˆ–ä»èŠ‚ç‚¹è¯»å–
3. **æ•…éšœæ£€æµ‹** â†’ é›†ç¾¤è‡ªåŠ¨æ£€æµ‹èŠ‚ç‚¹çŠ¶æ€
4. **æ•…éšœè½¬ç§»** â†’ ä»èŠ‚ç‚¹è‡ªåŠ¨æå‡ä¸ºä¸»èŠ‚ç‚¹

## ğŸ“Š æ§½ä½åˆ†é…

- æ§½ä½0-5460: redis-node-0 (ä¸») â†” redis-node-3 (ä»)
- æ§½ä½5461-10922: redis-node-1 (ä¸») â†” redis-node-4 (ä»)  
- æ§½ä½10923-16383: redis-node-2 (ä¸») â†” redis-node-5 (ä»)

## ğŸ”„ éƒ¨ç½²æµç¨‹

1. **å¯åŠ¨å®¹å™¨**: 6ä¸ªRedisèŠ‚ç‚¹ç‹¬ç«‹å¯åŠ¨
2. **ç­‰å¾…å°±ç»ª**: æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨å®Œæˆå¹¶é€šè¿‡å¥åº·æ£€æŸ¥
3. **æ£€æµ‹é›†ç¾¤**: è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨é›†ç¾¤é…ç½®
4. **åˆ›å»ºé›†ç¾¤**: å¦‚æ— é›†ç¾¤ï¼Œæ‰§è¡Œé›†ç¾¤åˆ›å»ºå‘½ä»¤
5. **éªŒè¯çŠ¶æ€**: ç¡®è®¤é›†ç¾¤çŠ¶æ€ä¸º`cluster_state:ok`

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **å¯†ç è®¤è¯**: ç»Ÿä¸€å¯†ç ä¿æŠ¤æ‰€æœ‰èŠ‚ç‚¹
- **ç½‘ç»œéš”ç¦»**: ä¸“ç”¨Dockerç½‘ç»œï¼Œå®¹å™¨é—´é€šä¿¡
- **æ•°æ®æŒä¹…åŒ–**: AOF + RDBåŒé‡å¤‡ä»½
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨ç›‘æ§èŠ‚ç‚¹çŠ¶æ€