# ğŸ“– Redis Cluster éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›åŸºäºå®˜æ–¹Redisé•œåƒçš„é«˜å¯ç”¨Redisé›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨**ç‹¬ç«‹èŠ‚ç‚¹å¯åŠ¨ + è‡ªåŠ¨é›†ç¾¤åˆ›å»º**çš„æ–¹å¼ï¼Œç¡®ä¿éƒ¨ç½²ç¨³å®šå¯é ã€‚

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### ğŸ“¦ æŠ€æœ¯æ ˆ
- **Redisç‰ˆæœ¬**: 7.4 (å®˜æ–¹é•œåƒ)
- **å®¹å™¨ç¼–æ’**: Docker Compose
- **ç½‘ç»œ**: è‡ªå®šä¹‰bridgeç½‘ç»œ
- **æ•°æ®æŒä¹…åŒ–**: Dockerå· + AOF/RDB

### ğŸ”§ é›†ç¾¤é…ç½®
- **èŠ‚ç‚¹æ•°é‡**: 6ä¸ªï¼ˆ3ä¸»3ä»ï¼‰
- **æ•°æ®åˆ†ç‰‡**: 16384ä¸ªæ§½ä½
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨
- **å¯†ç è®¤è¯**: å¯ç”¨

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: macOS ARM (æ¨è) æˆ– Linux/Windows
- **å†…å­˜**: æœ€å°‘4GBå¯ç”¨å†…å­˜
- **ç¡¬ç›˜**: æœ€å°‘10GBå¯ç”¨ç©ºé—´

#### è½¯ä»¶ä¾èµ–
```bash
# æ£€æŸ¥Dockerç‰ˆæœ¬
docker --version  # éœ€è¦ 20.10+

# æ£€æŸ¥Docker Composeç‰ˆæœ¬  
docker-compose --version  # éœ€è¦ V2

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :7000-7005
lsof -i :17000-17005
lsof -i :5540,9121
```

### 2. è·å–é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/jigexiansen/redis-cluster.git
cd redis-cluster

# æ£€æŸ¥ç¯å¢ƒ
make setup
```

### 3. ä¸€é”®éƒ¨ç½²

```bash
# å¯åŠ¨é›†ç¾¤ï¼ˆåŒ…å«è‡ªåŠ¨åˆ›å»ºé›†ç¾¤ï¼‰
make start
```

### 4. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
make status

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
make cluster-info

# æµ‹è¯•é›†ç¾¤åŠŸèƒ½
make test
```

## ğŸ”§ è¯¦ç»†éƒ¨ç½²æµç¨‹

### é˜¶æ®µ1: å®¹å™¨å¯åŠ¨
```bash
# Docker Composeå¯åŠ¨6ä¸ªRedisèŠ‚ç‚¹
docker-compose up -d

# æ¯ä¸ªèŠ‚ç‚¹é…ç½®ï¼š
# - ç‹¬ç«‹Rediså®ä¾‹
# - å¯ç”¨é›†ç¾¤æ¨¡å¼
# - å¯†ç è®¤è¯
# - æ•°æ®æŒä¹…åŒ–
```

### é˜¶æ®µ2: ç­‰å¾…å°±ç»ª
```bash
# ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œå…¨å¯åŠ¨
sleep 15

# å¥åº·æ£€æŸ¥ç¡®è®¤èŠ‚ç‚¹çŠ¶æ€
# healthcheck: redis-cli ping
```

### é˜¶æ®µ3: é›†ç¾¤æ£€æµ‹
```bash
# æ£€æŸ¥æ˜¯å¦å·²æœ‰é›†ç¾¤é…ç½®
cluster_state=$(docker exec redis-node-0 redis-cli -a redis123456 -c cluster info 2>/dev/null | grep "cluster_state:ok")
```

### é˜¶æ®µ4: è‡ªåŠ¨åˆ›å»ºé›†ç¾¤
```bash
# å¦‚æœæ— é›†ç¾¤ï¼Œè‡ªåŠ¨åˆ›å»º
if [ -z "$cluster_state" ]; then
    docker exec redis-node-0 redis-cli -a redis123456 --cluster create \
        redis-node-0:6379 redis-node-1:6379 redis-node-2:6379 \
        redis-node-3:6379 redis-node-4:6379 redis-node-5:6379 \
        --cluster-replicas 1 --cluster-yes
fi
```

### é˜¶æ®µ5: çŠ¶æ€éªŒè¯
```bash
# ç¡®è®¤é›†ç¾¤çŠ¶æ€æ­£å¸¸
# cluster_state:ok
# cluster_slots_assigned:16384
# cluster_known_nodes:6
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### Webç®¡ç†ç•Œé¢
- **Redis Insight**: http://localhost:5540
- **åŠŸèƒ½**: å¯è§†åŒ–é›†ç¾¤çŠ¶æ€ã€æ•°æ®æµè§ˆã€æ€§èƒ½ç›‘æ§

### æŒ‡æ ‡ç›‘æ§
- **Redis Exporter**: http://localhost:9121
- **PrometheusæŒ‡æ ‡**: é›†ç¾¤çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ã€èŠ‚ç‚¹å¥åº·

### å‘½ä»¤è¡Œç®¡ç†
```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
make status

# å®æ—¶æ—¥å¿—
make logs

# æ€§èƒ½æµ‹è¯•
make test

# æ•°æ®å¤‡ä»½
make backup
```

## ğŸ”’ å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
- **éš”ç¦»ç½‘ç»œ**: ä¸“ç”¨Dockerç½‘ç»œ`redis-cluster-network`
- **ç«¯å£æ˜ å°„**: ä»…å¿…è¦ç«¯å£å¯¹å¤–æš´éœ²
- **é˜²ç«å¢™**: å»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™

### è®¤è¯æˆæƒ
- **å¯†ç ä¿æŠ¤**: ç»Ÿä¸€å¯†ç `redis123456`ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ï¼‰
- **è®¿é—®æ§åˆ¶**: å®¹å™¨é—´é€šä¿¡é™åˆ¶

### æ•°æ®å®‰å…¨
- **æ•°æ®æŒä¹…åŒ–**: AOF + RDBåŒé‡ä¿éšœ
- **å®šæœŸå¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½è„šæœ¬
- **åŠ å¯†ä¼ è¾“**: æ”¯æŒTLSï¼ˆå¯é€‰é…ç½®ï¼‰

## ğŸ›ï¸ é…ç½®å®šåˆ¶

### ä¿®æ”¹å¯†ç 
```yaml
# docker-compose.yml
command: >
  redis-server 
  --requirepass YOUR_PASSWORD
  --masterauth YOUR_PASSWORD
```

### è°ƒæ•´å†…å­˜
```yaml
# docker-compose.yml
deploy:
  resources:
    limits:
      memory: 1G
```

### ä¿®æ”¹ç«¯å£
```yaml
# docker-compose.yml
ports:
  - "YOUR_PORT:6379"
```

## ğŸ”„ å‡çº§å’Œç»´æŠ¤

### æ»šåŠ¨å‡çº§
```bash
# åœæ­¢é›†ç¾¤
make stop

# æ‹‰å–æ–°é•œåƒ
docker pull redis:7.4

# é‡æ–°å¯åŠ¨
make start
```

### æ•°æ®è¿ç§»
```bash
# å¤‡ä»½æ•°æ®
make backup

# è¿ç§»åˆ°æ–°ç¯å¢ƒ
# 1. éƒ¨ç½²æ–°é›†ç¾¤
# 2. æ¢å¤æ•°æ®å¤‡ä»½
# 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
```

### æ‰©å®¹ç¼©å®¹
```bash
# æ·»åŠ èŠ‚ç‚¹ï¼ˆéœ€è¦ä¿®æ”¹é…ç½®ï¼‰
# 1. æ›´æ–°docker-compose.yml
# 2. å¯åŠ¨æ–°èŠ‚ç‚¹
# 3. åŠ å…¥é›†ç¾¤
# 4. é‡æ–°åˆ†é…æ§½ä½
```

## ğŸš¨ æ•…éšœæ’é™¤

è¯¦ç»†çš„æ•…éšœæ’é™¤æŒ‡å—è¯·å‚è€ƒ [troubleshooting.md](troubleshooting.md)

### å¸¸è§é—®é¢˜
- **ç«¯å£å†²çª**: æ£€æŸ¥ç«¯å£å ç”¨
- **å†…å­˜ä¸è¶³**: å¢åŠ Dockerå†…å­˜é™åˆ¶
- **é›†ç¾¤åˆ›å»ºå¤±è´¥**: æ£€æŸ¥èŠ‚ç‚¹ç½‘ç»œè¿é€šæ€§
- **æ•°æ®ä¸¢å¤±**: æ¢å¤å¤‡ä»½æ•°æ®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“– [é¡¹ç›®æ–‡æ¡£](../README.md)
- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/jigexiansen/redis-cluster/issues)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/jigexiansen/redis-cluster/discussions)